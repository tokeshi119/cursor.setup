---
name: mock-to-api-design
description: 画面モックからAPI設計を行うワークフロー。フロントエンド主導でAPI設計を進め、OpenAPI形式で文書化する。モック、Figma、画面設計からAPI設計を行う際に使用する。
---

# モックからAPI設計を行う

画面モックからAPI設計を行うための7ステップのワークフロー。フロントエンド主導でAPI設計を進め、最終的にOpenAPI形式で文書化する。

## 前提条件

- フロントエンド主導でAPI設計を進める
- バックエンドはレスポンスJSON構造の詳細を最適化する裁量を持つ
- OpenAPI (Swagger) 形式で最終的に文書化する

## ワークフロー概要

1. **画面要件の分析**: モックから表示データとユーザー操作を抽出
2. **エンドポイント設計**: RESTfulリソースとHTTPメソッドを決定
3. **リクエスト仕様の設計**: パラメータ（パス、クエリ、ボディ）を定義
4. **レスポンス構造のサンプル提示**: データ構造の例示とバックエンド裁量範囲の明記
5. **共通仕様の定義**: 認証、エラーハンドリング、ステータスコード
6. **OpenAPI形式での文書化**: YAML形式で完全なAPI仕様を作成
7. **バックエンドへの引き継ぎ**: レビュー依頼文書と確認事項の整理

## クイックスタート

### ステップ1: 画面要件の分析

モックを分析して以下を抽出：

**表示データ項目**
- 画面に表示される全てのデータ項目をリストアップ
- 各項目のデータ型を推測（文字列、数値、日付、配列など）
- 項目の階層関係を整理

**ユーザー操作**
- 検索機能（検索対象フィールドは？）
- ソート機能（ソート可能な項目は？）
- フィルタ/絞り込み（条件は？）
- ページネーション（必要か？）
- データの作成/更新/削除
- 一括操作（複数選択など）

**関連画面との整合性**
- 同じデータを使用する他の画面はないか？
- 画面間の遷移で引き継ぐデータは何か？

### ステップ2: エンドポイント設計

RESTfulなリソース設計：

```
GET    /api/v1/{resources}           # 一覧取得
GET    /api/v1/{resources}/{id}      # 詳細取得
POST   /api/v1/{resources}           # 新規作成
PUT    /api/v1/{resources}/{id}      # 更新
DELETE /api/v1/{resources}/{id}      # 削除
```

### ステップ3: リクエスト仕様の設計

パラメータを分類：
- **パスパラメータ**: リソース識別子（例: {friendId}）
- **クエリパラメータ**: 検索、フィルタ、ソート、ページング
- **リクエストボディ**: POST/PUT/PATCHで送信するデータ

各パラメータについて以下を明記：
- パラメータ名（キャメルケース推奨）
- データ型（string, integer, boolean, array等）
- 必須/任意
- デフォルト値（任意の場合）
- 制約条件（最小値、最大値、形式、列挙値等）
- 説明

### ステップ4: レスポンス構造のサンプル提示

共通レスポンス構造：
- データ本体（data）
- ページネーション情報（該当する場合）
- メタデータ（total件数、処理時間等）

バックエンドへの裁量部分を明記：
- フィールド名の調整
- データ型の変更（文字列⇔数値等）
- 追加フィールドの提案
- N+1問題回避のための構造変更

### ステップ5: 共通仕様の定義

**認証方式**
```yaml
認証:
  方式: Bearer Token (AWS Cognito)
  ヘッダー: Authorization: Bearer {access_token}
```

**エラーレスポンス形式**
```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "入力値に誤りがあります",
    "details": [...]
  }
}
```

**HTTPステータスコード**
- 200 OK: 成功（GET, PUT, PATCH）
- 201 Created: 作成成功（POST）
- 204 No Content: 成功（DELETE）
- 400 Bad Request: リクエストパラメータ不正
- 401 Unauthorized: 認証エラー
- 403 Forbidden: 権限エラー
- 404 Not Found: リソース未存在
- 409 Conflict: リソース競合
- 422 Unprocessable Entity: ビジネスロジックエラー
- 500 Internal Server Error: サーバーエラー

### ステップ6: OpenAPI形式での文書化

OpenAPI 3.0形式でYAMLファイルを作成：

```yaml
openapi: 3.0.0
info:
  title: [API名]
  version: 1.0.0

servers:
  - url: https://api.example.com/api/v1

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer

paths:
  # 各エンドポイント定義
```

### ステップ7: バックエンドへの引き継ぎ

レビュー依頼文書を作成：
- 概要と主要機能
- OpenAPI仕様ファイルのパス
- 特に確認してほしい点
- バックエンド側で決定してほしい事項
- スケジュール

## 詳細な手順

詳細な手順、出力形式のテンプレート、チェックリストは [reference.md](reference.md) を参照してください。

## 使用例

### モックからAPI設計を依頼する場合

```
以下の画面モックから、API設計のための画面要件を分析してください。

[モック画像またはFigmaリンク]

分析観点:
1. 表示データ項目の抽出（型、必須/任意も推測）
2. ユーザー操作の洗い出し（検索、ソート、フィルタ、ページング等）
3. 関連画面との整合性確認

出力形式は「ステップ1: 画面要件の分析」の出力形式に従ってください。
```

### 各ステップを順次実行する場合

```
以下のステップ[N]の入力情報をもとに、ステップ[N]を実行してください。

[入力情報]

実行内容と出力形式は手順書の「ステップ[N]」に従ってください。
```

## 参考

- 既存のAPI設計ガイドライン: `.cursor/skills/api-design.md`
- 詳細な手順とチェックリスト: [reference.md](reference.md)
