# 画面仕様: 利用集計（月別/日別/時間別）

Last updated: 2026-02-02

## 1. 基本情報
- 画面ID: usage-stats
- 画面名: 利用集計（月別/日別/時間別）
- 目的/ゴール: システム利用料算定のため、新規友だち追加数とLINEメッセージ数（push/reply）を集計表示する
- 対象ユーザー/権限: 管理者
- 添付スクショ/モック: 共有済み画像（2026-02-02, 月別/日別/時間別）

## 2. 画面タイプ
- 一覧: yes
- 詳細: no
- 作成: no
- 編集: no
- 削除: no

## 3. 必要データ（最小）
- 参照テーブル: stats_monthly / stats_daily / stats_hourly（マテリアライズドビュー）
- 主キー: 期間（month/day/hour）
- 表示項目:
  - 期間ラベル（年月 / 日 / 時間）
  - 友だち登録数
  - LINE配信完了数（push）
  - LINE配信完了数（reply）
  - 合計配信数（push + reply）
- 編集項目: なし
- 既定値/初期値:
  - 月別: 現在年（JST）
  - 日別: 選択した月（JST）
  - 時間別: 選択した日（JST）

## 4. 検索・フィルタ・ソート・ページング
- 検索条件: なし
- フィルタ条件: なし（期間の前後移動のみ）
- ソート条件: 期間昇順固定
- ページング: なし

## 5. 主要操作（ボタン/アクション）
- 前年/翌年（月別の前後移動）
- 前月/翌月（日別の前後移動）
- 前日/翌日（時間別の前後移動）
- 粒度切替（月別/日別/時間別）
- ドリルダウン:
  - 月別の行クリックで日別へ
  - 日別の行クリックで時間別へ

## 6. バリデーション/制約
- year: 4桁の西暦
- month: YYYY-MM
- date: YYYY-MM-DD
- 集計はJST固定
- 0件の期間も必ず行として表示

## 7. APIメモ（暫定）
- エンドポイント候補: GET /stats/usage
- メソッド: GET
- リクエスト要約: granularity + year/month/date で集計期間を指定
- レスポンス要約: 合計行 + 期間ごとの明細行

## 8. 備考
- 課金対象は push / reply のみ（greetは除外）
